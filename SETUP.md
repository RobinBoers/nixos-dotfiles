# NixOS setup

## 1. Pull configuration.nix

```shell
cd /etc/nixos
sudo rm -rf configuration.nix
sudo wget https://raw.githubusercontent.com/RobinBoers/nixos-dotfiles/master/configuration.nix
sudo nixos-rebuild switch
```

## 2. Install home-manager

```shell
nix-channel --add https://github.com/nix-community/home-manager/archive/release-23.05.tar.gz home-manager
nix-channel --update
```

## 3. Pull home.nix

```shell
# Initialize home-manager
home-manager init
cd ~/.config/home-manager

# Remove default config
rm -rf home.nix

# Pull home.nix & co
wget https://raw.githubusercontent.com/RobinBoers/nixos-dotfiles/master/home.nix
wget https://raw.githubusercontent.com/RobinBoers/nixos-dotfiles/master/sway.nix
wget https://raw.githubusercontent.com/RobinBoers/nixos-dotfiles/master/neovim.nix
```

## 4. Restart shell & run home-manager

```shell
exit

# Remove default fish config to prevent
# conflict when home-manager tries to generate it
rm -rf .config/fish/config.fish

home-manager swith
```

## 5. Authenticate

### Export GPG keys (on old machine)

```shell
gpg --export ${ID} > public.key
gpg --export-secret-key ${ID} > private.key
```

## Import GPG keys (on new machine)

```shell
gpg --import public.key
gpg --import secret.key
```

Also copy over the contents of `~/.ssh` (except `~/.ssh/config` ofc, because that will be generated by home-manager).

## Trust GPG keys

Get key IDs:

```shell
gpg --list-keys --keyid-format long
```

Trust keys:

```shell
gpg --edit-key <ID>

gpg> trust
*choose 5*

gpg> quit
```

## Setup passwordstore

```shell
git clone git.geheimesite.nl:meta/passwords .passwords
```

## Setup keyrings & other authentication

```shell
git clone --bare gcrypt::git.geheimesite.nl:meta/secrets ~/.secrets
secrets config remote.origin.gcrypt-participants "CBDF033DB0E73C541469A284B624C660CDF0AB8A"
secrets config remote.origin.gcrypt-signingkey "CBDF033DB0E73C541469A284B624C660CDF0AB8A"
secrets checkout
```
